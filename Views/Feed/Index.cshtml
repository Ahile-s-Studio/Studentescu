@model List<Studentescu.ViewModels.PostViewModel>
@{
    ViewBag.Title = "title";
    Layout = "_Layout";
}

<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-200 mb-6">For You</h1>
    <a href="/Post/Create" class="text-white bg-purple-500 hover:bg-purple-600 py-2 px-4 
    rounded-lg transition-colors mb-6 inline-block">
        Create Post
    </a>
    <div id="post-list" class="space-y-6">
        @foreach (var post in Model)
        {
            @Html.Partial("_PostCardPartial", post)
        }
    </div>
</div>


<script>
    let pageNumber = 1;
    const pageSize = 5;
    let isLoading = false;

    async function fetchMorePosts() {
        if (isLoading) return;

        isLoading = true;
        pageNumber++;

        try {
            const response = await fetch(`/Feed/LoadMore?pageNumber=${pageNumber}&pageSize=${pageSize}`);

            if (response.ok) {
                const html = await response.text();
                if (html.trim() !== "") {
                    document.getElementById("post-list").insertAdjacentHTML("beforeend", html);
                } else {
                    window.removeEventListener("scroll", handleScroll);
                }
            } else {
                console.error("Failed to load more posts.");
            }
        } catch (error) {
            console.error("Error fetching posts:", error);
        } finally {
            isLoading = false;
        }
    }

    function handleScroll() {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
            fetchMorePosts();
        }
    }

    window.addEventListener("scroll", handleScroll);
</script>
